import{_ as v,D as A,r as b,o as c,c as f,w as g,a as w,b as t,t as e,d as R,e as h,f as P,g as x,h as q,i as L,v as $,u as D,F as k,j as C}from"./main-a6d67f0f.js";const V={emits:["join","exit"],props:["pool","account"],computed:{address(){var s;return(s=this.account)==null?void 0:s.bech32Address}},components:{DenomUnitConverter:A}},E={class:"flex"},M={class:"grow"},F={class:""},U={class:"stats shadow stats-vertical xl:stats-horizontal bg-base-200 grow w-full flex"},I={class:"stat"},J={class:"stat-value uppercase"},N={class:"stat-title"},T={class:"stat-actions join"},B=["disabled"],O=["disabled"],H={class:"stat"},Y={class:"stat-title"},z={class:"stat-value truncate"},Q={class:"stat-title uppercase"},W={class:"stat-desc text-secondary"},G={class:"stat"},K={class:"stat-title"},X={class:"stat-value truncate"},Z={class:"stat-title uppercase"},tt={class:"stat-desc text-secondary"};function ot(s,n,l,_,o,a){const u=b("DenomUnitConverter");return c(),f(u,{internalDenom:l.pool.base.denom,internalAmount:l.pool.base.balance},{default:g(({displayDenom:i,displayAmount:r,displayName:d,displayDescription:m})=>[w(u,{internalDenom:l.pool.quote.denom,internalAmount:l.pool.quote.balance},{default:g(({displayDenom:y,displayAmount:S})=>[t("div",E,[t("div",M,[t("div",F,"Pool: "+e(l.pool.pool_id),1),t("div",U,[t("div",I,[t("div",J,e(d||i),1),t("div",N,e(m),1),t("div",T,[t("button",{class:"btn btn-primary btn-sm join-item",onClick:n[0]||(n[0]=j=>s.$emit("join",l.pool)),disabled:!l.account}," Join Pool ",8,B),t("button",{class:"btn btn-primary btn-sm join-item",onClick:n[1]||(n[1]=j=>s.$emit("exit",l.pool)),disabled:!l.account}," Exit Pool ",8,O)])]),t("div",H,[t("div",Y,"1 "+e(i)+" ≃",1),t("div",z,e((S/r).toLocaleString(void 0,{notation:"standard",maximumSignificantDigits:3})),1),t("div",Q,e(y),1),t("div",W," Pool liquidity: "+e(r)+" "+e(i),1)]),t("div",G,[t("div",K,"1 "+e(y)+" ≃",1),t("div",X,e((r/S).toLocaleString(void 0,{notation:"standard",maximumSignificantDigits:3})),1),t("div",Z,e(i),1),t("div",tt," Pool liquidity: "+e(S)+" "+e(y),1)])])])])]),_:2},1032,["internalDenom","internalAmount"])]),_:1},8,["internalDenom","internalAmount"])}const st=v(V,[["render",ot]]),et={props:{pool:Object,account:Object},data(){return{baseValue:"",quoteValue:"",txResult:null,inFlight:!1,error:null,updating:null,availableShares:0}},components:{DenomUnitConverter:A},computed:{sharesDenom:function(){return`pool-${this.pool.pool_id}.whaleswap.dys`},address:function(){var s;return(s=this.account)==null?void 0:s.bech32Address},baseAmount:{get(){return this.baseValue},set(s){this.updating!=="quote"&&(this.updating="base",this.baseValue=s,this.pool.base.balance&&this.pool.quote.balance&&(this.quoteValue=Math.ceil(s*this.pool.quote.balance/this.pool.base.balance)),this.updating=null)}},quoteAmount:{get(){return this.quoteValue},set(s){this.updating!=="base"&&(this.updating="quote",this.quoteValue=s,this.pool.base.balance&&this.pool.quote.balance&&(this.baseValue=Math.ceil(s*this.pool.base.balance/this.pool.quote.balance)),this.updating=null)}}},methods:{async fetchPoolShares(){console.log("fetching pool shares",this.sharesDenom),this.availableShares=0;let s="cosmos.bank.v1beta1/QueryBalance",n={query:{denom:this.sharesDenom},params:{address:this.address}};return parseInt((await dysonVueStore.dispatch(s,n)).balance.amount)},async addLiquidity(){this.inFlight=!0,this.error=null;const s="dyson/sendMsgRun",n={value:{creator:this.address,address:"whaleswap.dys",function_name:"join_pool",kwargs:JSON.stringify({pool_id:this.pool.pool_id}),coins:`${this.baseAmount} ${this.pool.base.denom}, ${this.quoteAmount} ${this.pool.quote.denom}`},fee:[{amount:"223",denom:"dys"}],gas:"2230000"};console.log("data",n);try{this.txResult=await R(s,n)}catch(l){this.error=l.toString()}finally{this.inFlight=!1}}},created:async function(){this.availableShares=await this.fetchPoolShares()},watch:{pool:{handler:async function(s){console.log("pool changed",s.pool_id),this.availableShares=await this.fetchPoolShares()},deep:!0},"account.bech32Address":{handler:async function(s){console.log("account changed",s.bech32Address),this.availableShares=await this.fetchPoolShares()},deep:!0}}},nt={key:0},lt={key:0,class:"flex flex-col w-full border-opacity-50"},at=t("h3",{class:"font-bold text-lg error"},"Error!",-1),it={key:1,class:"flex flex-col w-full border-opacity-50"},ct=t("h3",{class:"font-bold text-lg success"},"Success!",-1),rt={key:1,class:"flex flex-col w-full border-opacity-50"},dt=t("h1",{class:"text-2xl font-bold"},"Join Pool",-1),ut={class:"grid flex-grow card"},ht={class:"alert"},_t={class:""},mt={class:""},pt={class:"form-control"},bt=t("label",{class:"label"},[t("span",{class:"label-text text-lg"},"Add Exactly")],-1),ft=["value","onInput"],gt={class:"label"},xt={class:"text-lg uppercase"},vt=t("div",{class:"divider"},"And",-1),yt={class:"grid flex-grow card"},St={class:"form-control"},wt=t("label",{class:"label"},[t("span",{class:"label-text text-lg"},"Add Exactly")],-1),Pt=["value","onInput"],kt={class:"label"},At={class:"text-lg uppercase"},Rt={key:0,class:"py-4 text-red-500"},qt=["disabled"];function jt(s,n,l,_,o,a){const u=b("DenomUnitConverter");return o.txResult?(c(),h("div",nt,[o.error?(c(),h("div",lt,[at,t("pre",null,e(o.error),1)])):(c(),h("div",it,[ct,t("p",null,"Transaction Hash: "+e(o.txResult.transactionHash),1),t("p",null,"Shares Received: "+e(o.txResult.result.shares)+" "+e(o.txResult.result.share_denom),1),o.txResult.result.refund.length>0?(c(),f(u,{key:0,internalDenom:o.txResult.result.refund[0].denom,internalAmount:o.txResult.result.refund[0].amount},{default:g(({displayAmount:i,displayDenom:r})=>[P(" Refund Amount: "+e(i)+" "+e(r),1)]),_:1},8,["internalDenom","internalAmount"])):x("",!0)]))])):(c(),h("div",rt,[dt,t("div",ut,[t("div",ht,[t("span",_t," Your shares: "+e(o.availableShares.toLocaleString())+" ("+e(o.availableShares/l.pool.total_shares*100)+"%)",1),t("span",mt," Total shares: "+e(l.pool.total_shares.toLocaleString()),1)]),t("div",pt,[bt,w(u,{internalDenom:l.pool.base.denom,internalAmount:a.baseAmount,"onUpdate:internalAmount":n[0]||(n[0]=i=>a.baseAmount=i)},{default:g(({displayAmount:i,displayDenom:r,handleDisplayChange:d})=>[t("input",{class:"input input-bordered input-primary",value:i,onInput:m=>d(r,m.target.value),placeholder:""},null,40,ft),t("label",gt,[t("span",xt,e(r),1)])]),_:1},8,["internalDenom","internalAmount"])])]),vt,t("div",yt,[t("div",St,[wt,w(u,{internalDenom:l.pool.quote.denom,internalAmount:a.quoteAmount,"onUpdate:internalAmount":n[1]||(n[1]=i=>a.quoteAmount=i)},{default:g(({displayAmount:i,displayDenom:r,handleDisplayChange:d})=>[t("input",{class:"input input-bordered input-primary",value:i,onInput:m=>d(r,m.target.value),placeholder:""},null,40,Pt),t("label",kt,[t("span",At,e(r),1)])]),_:1},8,["internalDenom","internalAmount"])])]),o.error?(c(),h("p",Rt,e(o.error),1)):x("",!0),t("button",{class:"btn btn-lg btn-block btn-primary",onClick:n[2]||(n[2]=q((...i)=>a.addLiquidity&&a.addLiquidity(...i),["prevent"])),disabled:!a.address||o.inFlight}," Add Liquidity ",8,qt)]))}const Lt=v(et,[["render",jt]]),$t={props:["pool","account"],data(){return{coins:"",error:"",inFlight:!1,txResult:null,availableShares:0}},computed:{sharesDenom:function(){return`pool-${this.pool.pool_id}.whaleswap.dys`},address:function(){var s;return(s=this.account)==null?void 0:s.bech32Address}},methods:{async fetchPoolShares(){console.log("fetching pool shares",this.sharesDenom);let s="cosmos.bank.v1beta1/QueryBalance",n={query:{denom:this.sharesDenom},params:{address:this.address}};return parseInt((await dysonVueStore.dispatch(s,n)).balance.amount)},async exitPool(s,n){this.inFlight=!0,this.error="";let l="dyson/sendMsgRun",_={value:{creator:this.address,address:"whaleswap.dys",function_name:"exit_pool",kwargs:JSON.stringify({pool_id:s}),coins:n+this.sharesDenom},fee:[{amount:"223",denom:"dys"}],gas:"2230000"};try{console.log(_),this.txResult=await R(l,_),console.log(this.txResult)}catch(o){console.log(o.toString()),this.error=o.toString()}this.inFlight=!1}},created:async function(){this.availableShares=await this.fetchPoolShares()},watch:{pool:{handler:async function(s){console.log("pool changed",s.pool_id),this.availableShares=await this.fetchPoolShares()},deep:!0},account:{handler:async function(s){console.log("account changed",s),this.availableShares=0,this.availableShares=await this.fetchPoolShares()},deep:!0}}},Dt={key:0},Ct={key:0,class:"flex flex-col w-full border-opacity-50"},Vt=t("h3",{class:"font-bold text-lg error"},"Error!",-1),Et={key:1,class:"flex flex-col w-full border-opacity-50"},Mt=t("h3",{class:"font-bold text-lg success"},"Success!",-1),Ft=t("br",null,null,-1),Ut={key:1,class:"flex flex-col w-full border-opacity-50"},It=t("h1",{class:"text-2xl font-bold text-base-content"},"Exit Pool",-1),Jt={class:"grid flex-grow card"},Nt={class:"alert"},Tt={class:""},Bt={class:""},Ot={class:"form-control"},Ht=t("label",{class:"label"},[t("span",{class:"label-text text-lg"},"Send Exactly ")],-1),Yt={class:"label"},zt={class:"label-text text-lg uppercase"},Qt=["disabled"],Wt={class:"py-4 text-red-500"};function Gt(s,n,l,_,o,a){return o.txResult?(c(),h("div",Dt,[o.txResult.error?(c(),h("div",Ct,[Vt,t("pre",null,e(o.txResult.error),1)])):(c(),h("div",Et,[Mt,t("p",null,"Transaction Hash: "+e(o.txResult.transactionHash),1),t("p",null,[P(" Sent: "+e(o.coins)+" "+e(a.sharesDenom),1),Ft,P(" You Recieved: "+e(o.txResult.result[0].amount)+" "+e(o.txResult.result[0].denom)+" and "+e(o.txResult.result[1].amount)+" "+e(o.txResult.result[1].denom),1)])]))])):(c(),h("div",Ut,[It,t("div",Jt,[t("div",Nt,[t("span",Tt," Your shares: "+e(o.availableShares.toLocaleString())+" ("+e(o.availableShares/l.pool.total_shares*100)+"%) ",1),t("span",Bt," Total shares: "+e(l.pool.total_shares.toLocaleString()),1)]),t("div",Ot,[Ht,L(t("input",{type:"text",placeholder:"",class:"input input-bordered input-primary","onUpdate:modelValue":n[0]||(n[0]=u=>o.coins=u)},null,512),[[$,o.coins]]),t("label",Yt,[t("span",zt,e(a.sharesDenom),1)])])]),t("button",{class:"btn btn-lg btn-block btn-primary",onClick:n[1]||(n[1]=q(u=>a.exitPool(l.pool.pool_id,o.coins),["prevent"])),disabled:!a.address||o.inFlight}," Sign Tx ",8,Qt),t("p",Wt,e(o.error),1)]))}const Kt=v($t,[["render",Gt]]),p=D(),Xt={props:["account"],data(){return{joinPool:null,exitPool:null,bgUrl:new URL("/assets/swap-bg-c6360bc5.jpg",self.location).href}},computed:{pools(){return Object.values(p.pools).sort((n,l)=>{const _=n.quote.balance,o=l.quote.balance;return _>o?-1:_<o?1:0})},numPools(){return p.numPools||0},numSwaps(){return p.numTrades||0},tvl(){return p.tvl||0}},methods:{join(s){this.joinPool=s,this.window.joinModal.showModal()},exit(s){this.exitPool=s,this.window.exitModal.showModal()}},components:{PoolListItem:st,JoinPool:Lt,ExitPool:Kt},async created(){await p.setupWebsocket()}},Zt={class:"py-10 lg:pl-72"},to={class:"px-4 sm:px-6 lg:px-8 grid gap-4 grid-cols-1"},oo={class:"stats lg:stats-horizontal"},so={class:"stat"},eo=t("div",{class:"stat-title"},"Number of Pools",-1),no={class:"stat-value"},lo={class:"stat"},ao=t("div",{class:"stat-title"},"Number of Swaps",-1),io={class:"stat-value"},co={class:"stat"},ro=t("div",{class:"stat-title"},"Total Value",-1),uo={class:"stat-value"},ho={id:"joinModal",class:"modal"},_o={method:"dialog",class:"modal-box"},mo={method:"dialog",class:"modal-backdrop"},po={id:"exitModal",class:"modal"},bo={method:"dialog",class:"modal-box w-6/12"},fo={method:"dialog",class:"modal-backdrop"};function go(s,n,l,_,o,a){const u=b("PoolListItem"),i=b("JoinPool"),r=b("ExitPool");return c(),h(k,null,[t("main",Zt,[t("div",to,[t("div",oo,[t("div",so,[eo,t("div",no,e(a.numPools.toLocaleString()),1)]),t("div",lo,[ao,t("div",io,e(a.numSwaps.toLocaleString()),1)]),t("div",co,[ro,t("div",uo,e(a.tvl.toLocaleString())+" DYS ",1)])]),(c(!0),h(k,null,C(a.pools,d=>(c(),f(u,{pool:d,key:d,account:l.account,onJoin:a.join,onExit:a.exit},null,8,["pool","account","onJoin","onExit"]))),128))])]),t("dialog",ho,[t("form",_o,[t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:n[0]||(n[0]=d=>a.join=null)}," ✕ "),o.joinPool?(c(),f(i,{key:0,pool:o.joinPool,account:l.account},null,8,["pool","account"])):x("",!0)]),t("form",mo,[t("button",{onClick:n[1]||(n[1]=d=>o.joinPool=null)})])]),t("dialog",po,[t("form",bo,[t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:n[2]||(n[2]=d=>o.exitPool=null)}," ✕ "),o.exitPool?(c(),f(r,{pool:o.exitPool,account:l.account,key:o.exitPool.pool_id},null,8,["pool","account"])):x("",!0)]),t("form",fo,[t("button",{onClick:n[3]||(n[3]=d=>o.exitPool=null)})])])],64)}const vo=v(Xt,[["render",go]]);export{vo as default};
